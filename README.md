---
html_document:
  toc: true
title: "Posting RMarkdown to a Wordpress Blog"
---



# rmd2wp Package
All the good versions of the name "Knit to Wordpress" were taken, so I've named the package unimaginatively *rmd2wp.*  The idea of this package is that you should be able to post your .Rmd files directly to your blog without having to mess with uploading any files, modifying any content/code afterwards, etc.  I found a couple attempts to do this ([knit2wp.com](https://wkmor1.wordpress.com/2012/07/01/rchievement-of-the-day-3-bloggin-from-r-14/) and [knit2wp](http://yihui.name/knitr/demo/wordpress/)), but neither worked out-of-the-box.


# knit2wordpress function
This function is based heavily on [wkmor1's function](https://wkmor1.wordpress.com/2012/07/01/rchievement-of-the-day-3-bloggin-from-r-14/) but updated to fit my needs.  It requires an *.Rmd*.  You can also specify `syntax.highlighter` argument.  It defaults to `NULL`, which will still result in monospace font, but won't necessarily understand any specific syntax coloring that you might be expecting.  You **can** specify a syntax-highlighter plugin that you use on your blog and it will format the code to work with that.  Currently supported highlighters include Syntax Highlighter Evolved, WP-Syntax and WP-Codebox.  It also supports code chunks in R or Python.  *knitr* supports many [other languages](http://yihui.name/knitr/demo/engines/), but support in `knit2wordpress` is not yet supported.


```r
knit2wordpress <- function(file,syntax.highlighter=NULL) {
  if (!(toupper(syntax.highlighter) %in% c('WP-SYNTAX','WP-CODEBOX','SYNTAX HIGHLIGHTER EVOLVED'))){
    stop("Need valid Syntax Highlighter.")
  }

  require(XML)
  post.content <- readLines(file)

  ## Operations common to all highlighters
  post.content <- gsub(" <", "&nbsp;<", post.content)
  post.content <- gsub("> ", ">&nbsp;", post.content)
  post.content <- gsub("<br/>", "&nbsp;", post.content)

  post.content <- htmlTreeParse(post.content)
  post.content <- paste(capture.output(print(post.content$children$html$children$body,
                                             indent = FALSE, tagSeparator = "")), collapse = "\n")
  ## Change to actual apostrophes
  post.content <- gsub('&apos;',"'",post.content)

  ## Somewhere this tag is getting inserted and is uninterpretable
  post.content <- gsub("<br/>", "&nbsp;", post.content)

  # Default syntax.highlighter is SYNTAX HIGHLIGHTER EVOLVED
  # These substitutions prepare the .html file assuming that will be the interpreter
  post.content <- gsub("<pre><code>","\\[code]",post.content)
  post.content <- gsub("<pre><code class=\"r\">","\\[code lang=\'r\'\\]",post.content)
  post.content <- gsub("<pre><code class=\"python\">","\\[code lang=\'python\'\\]",post.content)

  post.content <- gsub("</code></pre>","\\[/code\\]",post.content)

  ## Sometimes you get [code] tags put around each line in a code block.
  ## This makes them all part of one code block
  post.content <- gsub("\\[/code\\]\n\\[code\\]", "\n", post.content)
  post.content <- gsub("\\[/code\\]\n\\[code lang=\'r\'\\]", "\n", post.content)
  post.content <- gsub("\\[/code\\]\n\\[code lang=\'python\'\\]", "\n", post.content)

  # Prepare .html for WP-SYTNAX or WP-CODEBOX
  if (toupper(syntax.highlighter) %in% c('WP-SYNTAX','WP-CODEBOX')){
    # Translate [code] blocks to <pre> blocks
    post.content <- gsub("\\[code\\]", "<pre lang=\"R\" line=\"1\">", post.content)
    post.content <- gsub("\\[code lang=\'r\'\\]", "<pre lang=\"rsplus\" line=\"1\">", post.content)
    post.content <- gsub("\\[/code]", "</pre>", post.content)
  }

  return(post.content)
}
```

<a href="#top">Back to top</a>


# postToBlog() function

This is function is meant to be an easy to use wrapper of `knit2wordpress()` so that all you need to pass it is an *.Rmd* and a post title.  You can also specify post categories and tags.  The function also has a toggle for table of contents (`toc=`), which will create a table of contents based on h1-h3 tags (Generated by `#,##,###` in RMarkdown). Additionally, you can create a new post or edit an existing one with the `type=` argument.  If you pass 'new' then a new post is created.  If you pass 'edit' then it will attempt to update a current post.  If you give it a `postID` then it will update that post.  Otherwise, it will determin the postID by trying to match the title argument to an existing post.


```r
postToBlog <- function(file,
                     title='',
                     categories=c(),
                     tags=c(),
                     postID=NULL,
                     toc=TRUE,
                     type=c('new','edit'),
                     syntax.highlighter='Syntax Highlighter Evolved',
                     publish=FALSE){

  library(RWordPress)
  library(knitr)
  library(markdown)
  library(stringr)

  # Determine what kind of action to take
  type <- match.arg(type)

  ## Determine file name of .html output file
  file.name <- basename(file)
  dir.name <- dirname(file)

  file.extension <- file_ext(file.name)

  # Should this be a stop()?
  if(file.extension!='Rmd'){
    warning("File extension is not .Rmd.  Check input file to make sure it is correct format.")
  }

  file.root <- str_split(basename(file),pattern = paste('.',file.extension,sep=''))[[1]][1]
  html.file <- paste(file.root,'.html',sep='')
  current.director <- getwd()
  setwd(dir.name)

  cat('Directory:',dir.name,'\n')
  cat('RMarkdown file:', file.name,'\n')
  cat('HTML file:', html.file,'\n')
  cat('Blog URL:', getOption('WordpressURL'),'\n')
  cat('Action Type:', type,'\n')
  cat('Syntax Highlighter:',syntax.highlighter,'\n')

  # in .Rprofile
  # options(WordpressLogin=('username'='password'),
  #         WordpressURL='http://www.yourblog.com/xmlrpc.php')

  # Table of Contents
  options(markdown.HTML.options =  c(markdownHTMLOptions(default = T),"toc","hard_wrap"))
  # options(markdown.HTML.options =  c(markdownHTMLOptions(default = T),"number_sections"))

  # Knit an HTML file
  knit2html(file.name)

  # If new category is used then create that category
  # Does not work
  if(length(categories)>=1 && FALSE){
    current.categories <- names(RWordPress::categories())
    new.categories <- !(categories %in% current.categories)
    sapply(categories[new.categories],function(x){
      newCategory(x)
    })
  }

  ## NEW POST
  if(type=='new'){
    newPost(
      list(
        description=knit2wordpress(html.file,syntax.highlighter=syntax.highlighter),
        title=title,
        categories=categories,
        mt_keywords=tags
      ),
      publish=publish)
    ## EDIT POST
  } else if(type=='edit') {
    posts <- RWordPress::getPosts()
    if(is.null(postID)){

      # Find Post ID
      postID <- posts[posts$title==title,'postid']
      # Check that there is a post to edit
      if(length(postID)==1 && !is.null(postID) && !is.na(postID)){
        print(paste('Editing post [',postID,']: ',title,'.',sep=''))
        editPost(postid = postID,
                 content=list(description=knit2wordpress(html.file,syntax.highlighter=syntax.highlighter),
                              title=title,
                              categories=categories,
                              mt_keyworkds=tags),
                 publish = publish
                  )
      }
      ## Iff there is exactly 1 post that matches ID given
    } else if(sum(posts$postid==postID) == 1){
      print(paste('Editing post [',postID,']: ',title,'.',sep=''))
      editPost(postid = postID,
               content=list(description=knit2wordpress(html.file,syntax.highlighter=syntax.highlighter),
                            title=title,
                            categories=categories,
                            mt_keyworkds=tags),
               publish = publish
      )
    }
  }
  setwd(current.director)
}
```

<a href="#top">Back to top</a>

# Example


```r
# Create New Wordpress Post from file
postToBlog('/path/to/file/posting-RMarkdown-to-Wordpress.Rmd',
           title='Posting RMarkdown to a Wordpress Blog',
           categories=c('R','packages'),
           tags=c('R','rmd2wp'),
           syntax.highlighter = 'Syntax Highlighter Evolved',   # WP-Syntax and WP-CodeBox also supported, case-insensitive 
           type='new',
           publish=FALSE)                                       # FALSE Will upload file as a draft
```

# Future Plans
If you specify categories that are not defined on the Wordpress site, they are currently omitted.  I'd like to create them, but they are not currently supported.  Language support other than R and Python will be added soon.

# More Resources
- [Package source on GitHub](https://github.com/rweyant/rmd2wp)
- [The original knit2wp.com() function](https://wkmor1.wordpress.com/2012/07/01/rchievement-of-the-day-3-bloggin-from-r-14/)
- [knit2wp() in knitr](http://yihui.name/knitr/demo/wordpress/)
- [3.14a](http://3.14a.ch/archives/2015/03/08/how-to-publish-with-r-markdown-in-wordpress/)
- [uni-kiel](http://www.uni-kiel.de/psychologie/rexrepos/posts/rerWorkflowWP.html)

<a href="#top">Back to top</a>

